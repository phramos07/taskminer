//===------------------------ recoverPoointerMD.h -------------------------===//
//
//                     The LLVM Compiler Infrastructure
//
// This file is distributed under the Universidade Federal de Minas Gerais -
// UFMG Open Source License. See LICENSE.TXT for details.
//
// Copyright (C) 2015   Gleison Souza Diniz Mendon?a
//
//===----------------------------------------------------------------------===//
//
// RecoverPointerMD is a class created for generate C code using
// the ID encoding.
//
// The name of variables generated by pass stay in NAME string. The 
// programmer can change this name in writeExpressions.h
//
//===----------------------------------------------------------------------===//
#include "llvm/Analysis/RegionInfo.h"
#include "llvm/Analysis/AliasAnalysis.h"
#include "llvm/Analysis/ScalarEvolutionExpressions.h"
#include "llvm/Analysis/ScalarEvolution.h"
#include "llvm/Analysis/LoopInfo.h"
#include <llvm/Transforms/Utils/BasicBlockUtils.h>

#include "PtrRangeAnalysis.h"

#include "constantsSimplify.h"
#include "recoverNames.h"
#include "recovercode.h"

using namespace lge;

namespace llvm {
  class ScalarEvolution;
  class AliasAnalysis;
  class SCEV;
  class DominatorTree;

  class DominanceFrontier;
  struct PostDominatorTree;
  class Value;
  class Region;
  class Instruction;
  class LoopInfo;
  class ArrayInference;

class RecoverPointerMD : RecoverCode {

  protected:

  //===---------------------------------------------------------------------===
  //                              Data Structs
  //===---------------------------------------------------------------------===
  // Data structs to identify a instruction with the command with C/C++ sintaxy:

  //===---------------------------------------------------------------------===

  std::string recoverLoadMD (Value *V, std::string name, int *var,
                            const DataLayout* DT);

  std::string recoverStoreMD (Value *V, std::string name, int *var,
                            const DataLayout* DT);

  bool hasGEPasOperand(Value *V);

  bool hasLOADasOperand(Value *V);

  std::string recoverGEPMD (Value *V, std::string name, int *var,
                            const DataLayout* DT);

  std::string getAccessStringMD (Value *V, std::string name, int *var,
                            const DataLayout* DT);

  public:

  RecoverPointerMD () {
    this->NewVars = 0;
    this->NAME = "LLVM";
    this->Valid = false;
    this->numPHIRec = 10;
    restric = true;
  }
  //===---------------------------------------------------------------------===  
  //                              Data Structs                                   
  //===---------------------------------------------------------------------===
  //===---------------------------------------------------------------------===

  bool isValidPointerMD (Value *V);

  std::string recoverPointerMD (Value *V, std::string name, int *var,
                            const DataLayout* DT);

};

}

//===----------------------------- recoverCode.h --------------------------===//
