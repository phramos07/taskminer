//====================================================================================================100
//====================================================================================================100
//	INCLUDE/DEFINE
//====================================================================================================100
//====================================================================================================100

// #include <stdlib.h>
// #include <string.h>
#include <stdio.h>
// #include <math.h>
// #include <time.h>
// #include <sys/types.h>
// #include <dirent.h>
// #include <errno.h>

//====================================================================================================100
//====================================================================================================100
//	WRITE FUNCTION
//====================================================================================================100
//====================================================================================================100

void write_graphics(	char* filename,
									float *input, 
									int data_rows, 
									int data_cols, 
									int major,
									int data_range){

	//================================================================================80
	//	VARIABLES
	//================================================================================80

	FILE* fid;
	int i, j;

	//================================================================================80
	//	CREATE/OPEN FILE FOR WRITING
	//================================================================================80

	fid = fopen(filename, "w");
	if( fid == NULL ){
		printf( "The file was not created/opened for writing\n" );
		return;
	}

	//================================================================================80
	//	WRITE PGM FILE HEADER
	//================================================================================80

	fprintf(fid, "P2\n");
	fprintf(fid, "%d %d\n", data_cols, data_rows);
	fprintf(fid, "%d\n", data_range);

	//================================================================================80
	//	WRITE VALUES TO THE FILE
	//================================================================================80

	// if matrix is saved row major in memory (C)
	if(major==0){
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
				fprintf(fid, "%d ", (int)input[i*data_cols+j]);
			}
			fprintf(fid, "\n");
		}
	}
	// if matrix is saved column major in memory (MATLAB)
	else{
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
				fprintf(fid, "%d ", (int)input[j*data_rows+i]);
			}
			fprintf(fid, "\n");
		}
	}

	//================================================================================80
	//	CLOSE FILE
	//================================================================================80

	fclose(fid);

}

//====================================================================================================100
//====================================================================================================100
//	READ FUNCTION
//====================================================================================================100
//====================================================================================================100

void read_graphics(	char* filename,
									float *input,
									int data_rows, 
									int data_cols,
									int major){

	//================================================================================80
	//	VARIABLES
	//================================================================================80

	FILE* fid;
	int i, j;
	char c;
	int temp;

	//================================================================================80
	//	OPEN FILE FOR READING
	//================================================================================80

	fid = fopen(filename, "r");
	if( fid == NULL ){
		printf( "The file was not opened for reading\n" );
		return;
	}

	//================================================================================80
	//	SKIP PGM FILE HEADER
	//================================================================================80

	i = 0;
	#pragma acc data copy()
	#pragma acc kernels
	#pragma acc loop independent
	while(i<3){
		c = fgetc(fid);
		if(c == '\n'){
			i = i+1;
		}
	};

	//================================================================================80
	//	READ VALUES FROM THE FILE
	//================================================================================80

	if(major==0){																// if matrix is saved row major in memory (C)
		long long int AI2[8];
		AI2[0] = data_rows > 0;
		AI2[1] = (AI2[0] ? data_rows : 0);
		AI2[2] = data_cols * AI2[1];
		AI2[3] = data_cols > 0;
		AI2[4] = (AI2[3] ? data_cols : 0);
		AI2[5] = AI2[2] + AI2[4];
		AI2[6] = AI2[5] * 4;
		AI2[7] = AI2[6] / 4;
		#pragma acc data copy(input[0:AI2[7]])
		#pragma acc kernels
		#pragma acc loop independent
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
				fscanf(fid, "%d", &temp);
				input[i*data_cols+j] = (float)temp;
			}
		}
	}
	else{																				// if matrix is saved column major in memory (MATLAB)
		long long int AI3[8];
		AI3[0] = data_rows > 0;
		AI3[1] = (AI3[0] ? data_rows : 0);
		AI3[2] = data_cols > 0;
		AI3[3] = (AI3[2] ? data_cols : 0);
		AI3[4] = data_rows * AI3[3];
		AI3[5] = AI3[1] + AI3[4];
		AI3[6] = AI3[5] * 4;
		AI3[7] = AI3[6] / 4;
		#pragma acc data copy(input[0:AI3[7]])
		#pragma acc kernels
		#pragma acc loop independent
		for(i=0; i<data_rows; i++){
			for(j=0; j<data_cols; j++){
				fscanf(fid, "%d", &temp);
				input[j*data_rows+i] = (float)temp;
			}
		}
	}

	//================================================================================80
	//	CLOSE FILE
	//================================================================================80

	fclose(fid);

}

